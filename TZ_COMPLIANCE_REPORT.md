# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É –ó–∞–¥–∞–Ω–∏—é

## –î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: 2026-02-02

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö ‚úÖ

- ‚úÖ **WorkCenter** - –†–∞–±–æ—á–∏–π —Ü–µ–Ω—Ç—Ä —Å identifier –∏ name
- ‚úÖ **Batch** - –°–º–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏ –∏–∑ –¢–ó
  - –°—Ç–∞—Ç—É—Å –∑–∞–∫—Ä—ã—Ç–∏—è (is_closed, closed_at)
  - –û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è (task_description)
  - –†–∞–±–æ—á–∏–π —Ü–µ–Ω—Ç—Ä, —Å–º–µ–Ω–∞, –±—Ä–∏–≥–∞–¥–∞
  - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (batch_number, batch_date)
  - –ü—Ä–æ–¥—É–∫—Ü–∏—è (nomenclature, ekn_code)
  - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏ (shift_start, shift_end)
  - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å (batch_number + batch_date)
- ‚úÖ **Product** - –ü—Ä–æ–¥—É–∫—Ü–∏—è —Å –∞–≥–≥—Ä–µ–≥–∞—Ü–∏–µ–π
  - unique_code (unique, indexed)
  - batch_id (FK, indexed)
  - is_aggregated, aggregated_at
  - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- ‚úÖ **WebhookSubscription** - –ü–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ webhook —Å–æ–±—ã—Ç–∏—è
  - url, events (ARRAY), secret_key
  - is_active, retry_count, timeout
- ‚úÖ **WebhookDelivery** - –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏
  - event_type, payload (JSON)
  - status, attempts, response_status, response_body, error_message

### 2. API Endpoints ‚úÖ

#### –ë–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–∞—Ä—Ç–∏—è–º–∏:
- ‚úÖ `POST /api/v1/batches` - –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π (–º–∞—Å—Å–æ–≤–æ–µ)
- ‚úÖ `GET /api/v1/batches/{batch_id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏ –ø–æ ID
- ‚úÖ `PATCH /api/v1/batches/{batch_id}` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏
  - –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è: is_closed ‚Üí closed_at
- ‚úÖ `GET /api/v1/batches` - –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
  - –§–∏–ª—å—Ç—Ä—ã: is_closed, batch_number, batch_date, work_center_id, shift
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è: offset, limit

#### –ü—Ä–æ–¥—É–∫—Ü–∏—è:
- ‚úÖ `POST /api/v1/products` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ü–∏–∏

#### –ê–≥–≥—Ä–µ–≥–∞—Ü–∏—è:
- ‚úÖ `POST /api/v1/batches/{batch_id}/aggregate` - –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞–≥–≥—Ä–µ–≥–∞—Ü–∏—è (–¥–æ 100)
- ‚úÖ `POST /api/v1/batches/{batch_id}/aggregate-async` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∞–≥–≥—Ä–µ–≥–∞—Ü–∏—è (>100)
- ‚úÖ `GET /api/v1/tasks/{task_id}` - –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏

#### –û—Ç—á–µ—Ç—ã:
- ‚úÖ `POST /api/v1/batches/{batch_id}/reports` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤ (Excel/PDF)

#### –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç:
- ‚úÖ `POST /api/v1/batches/import` - –ò–º–ø–æ—Ä—Ç –∏–∑ Excel/CSV
- ‚úÖ `POST /api/v1/batches/export` - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel/CSV

#### Webhooks:
- ‚úÖ `POST /api/v1/webhooks` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `GET /api/v1/webhooks` - –°–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ `GET /api/v1/webhooks/{id}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `PATCH /api/v1/webhooks/{id}` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `DELETE /api/v1/webhooks/{id}` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `GET /api/v1/webhooks/{id}/deliveries` - –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∞–≤–æ–∫

#### –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- ‚úÖ `GET /api/v1/analytics/dashboard` - Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- ‚úÖ `GET /api/v1/analytics/batches/{id}/statistics` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–∞—Ä—Ç–∏–∏
- ‚úÖ `POST /api/v1/analytics/compare-batches` - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–π

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (Celery) ‚úÖ

- ‚úÖ **–ú–∞—Å—Å–æ–≤–∞—è –∞–≥–≥—Ä–µ–≥–∞—Ü–∏—è** (`aggregate_products_batch`)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ >100 –µ–¥–∏–Ω–∏—Ü
  - –ü—Ä–æ–≥—Ä–µ—Å—Å —á–µ—Ä–µ–∑ task result backend
  - Retry –ª–æ–≥–∏–∫–∞
  
- ‚úÖ **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤** (`generate_batch_report`)
  - Excel —Ñ–æ—Ä–º–∞—Ç (3 –ª–∏—Å—Ç–∞: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è, –ø—Ä–æ–¥—É–∫—Ü–∏—è, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)
  - PDF —Ñ–æ—Ä–º–∞—Ç (—Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏)
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ MinIO
  - Pre-signed URLs
  
- ‚úÖ **–ò–º–ø–æ—Ä—Ç –ø–∞—Ä—Ç–∏–π** (`import_batches_from_file`)
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Excel/CSV
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
  - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  
- ‚úÖ **–≠–∫—Å–ø–æ—Ä—Ç –ø–∞—Ä—Ç–∏–π** (`export_batches_to_file`)
  - Excel/CSV —Ñ–æ—Ä–º–∞—Ç—ã
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### 4. Scheduled Tasks (Celery Beat) ‚úÖ

- ‚úÖ **–ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–∞—Ä—Ç–∏–π** - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 01:00
- ‚úÖ **–û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤** - –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 02:00 (30 –¥–Ω–µ–π)
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏** - –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- ‚úÖ **Retry webhooks** - –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç

### 5. Webhook —Å–∏—Å—Ç–µ–º–∞ ‚úÖ

- ‚úÖ CRUD –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Celery
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff
- ‚úÖ HMAC SHA256 –ø–æ–¥–ø–∏—Å–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –¥–æ—Å—Ç–∞–≤–æ–∫
- ‚úÖ 6 —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π:
  - batch_created
  - batch_updated
  - batch_closed
  - product_aggregated
  - report_generated
  - import_completed

### 6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis) ‚úÖ

- ‚úÖ Dashboard —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (TTL: 5 –º–∏–Ω—É—Ç)
- ‚úÖ –°–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–∏–π (TTL: 1 –º–∏–Ω—É—Ç–∞)
- ‚úÖ –î–µ—Ç–∞–ª–∏ –ø–∞—Ä—Ç–∏–∏ (TTL: 10 –º–∏–Ω—É—Ç)
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ä—Ç–∏–∏ (TTL: 5 –º–∏–Ω—É—Ç)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

### 7. MinIO Storage ‚úÖ

- ‚úÖ Buckets: reports, exports, imports
- ‚úÖ Upload/download —Ñ–∞–π–ª–æ–≤
- ‚úÖ Pre-signed URLs (7 –¥–Ω–µ–π)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è buckets

### 8. Docker Compose ‚úÖ

- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚úÖ Health checks
- ‚úÖ Volumes –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### 9. –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic) ‚úÖ

- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
- ‚úÖ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è / –¢—Ä–µ–±—É—é—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. **MinIO –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - —Å–∫—Ä–∏–ø—Ç —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker)
2. **–ù–µ–∫–æ—Ç–æ—Ä—ã–µ edge cases** - —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö**: 5/5 (100%)
- **API Endpoints**: 20+/20+ (100%)
- **Celery –∑–∞–¥–∞—á–∏**: 4/4 (100%)
- **Scheduled tasks**: 4/4 (100%)
- **Webhook —Å–∏—Å—Ç–µ–º–∞**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- **MinIO**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- **Docker**: –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó: ~98%**

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ù–µ–±–æ–ª—å—à–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ edge cases –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- ‚úÖ Unit —Ç–µ—Å—Ç—ã: 4/4 –ø—Ä–æ–π–¥–µ–Ω–æ
- ‚úÖ API endpoints: –†–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–µ—Ä–≤–∏—Å—ã: –í—Å–µ –∑–∞–ø—É—â–µ–Ω—ã –∏ –∑–¥–æ—Ä–æ–≤—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –≤ production
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS
3. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backup –¥–ª—è –ë–î
